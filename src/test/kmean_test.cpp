#include <iostream>
#include <gtest/gtest.h>
#include "kmean.h"

using namespace orpara;


/**
 * Data point class must implement several functions
 * 1. static public member:: dimension
 * 2. distance(double* centroid)
 * 3. void show(ostream& ous) for testing purpose
 */
class Testpoint {
   public:
      Testpoint() : x(0), y(0), z(0) {}
      Testpoint(long int xx, int yy, int zz) 
         : x(xx), y(yy), z(zz) {}
      double distance(double* centroid) const {
         double res=0;
         res += (x-centroid[0])*(x-centroid[0]);
         res += (y-centroid[1])*(y-centroid[1]);
         res += log((z-centroid[2])*(z-centroid[2]));
         return res;
      }
      void assign(double* centroid) const {
         //cout << "x=" << x << " y=" << y << " z=" << z << endl;
         centroid[0]=x;
         centroid[1]=y;
         centroid[2]=z;
         //cout << "after assign: " << centroid[0] 
         //   << ", " << centroid[1] << ", " << centroid[2] << endl;
      }
      void show(ostream& ous) const {
         ous << x << " " << y << " " << z;
      }
      static const int dimension=3;

   private:
      long int x;
      int y, z;
};

class KmeanTest : public testing::Test {
   protected:
      KmeanTest() 
         : rawdata{
{152859887,2,356}, {152859893,3,390}, {152859901,2,442}, {152859906,2,479}, {152859916,2,535},
{152859920,3,582}, {152859922,3,603}, {152859924,3,628}, {152859925,2,650}, {152859928,3,674},
{152859930,4,693}, {152859932,3,721}, {152859935,2,761}, {152859941,5,824}, {152859945,2,883},
{152859947,5,917}, {152859950,6,963}, {152859951,4,978}, {152859953,4,1016}, {152859955,7,1036},
{152859956,2,1050}, {152859963,2,1130}, {152859966,2,1159}, {152859967,4,1181}, {152859972,2,1241},
{152859974,8,1271}, {152859975,3,1281}, {152859978,2,1333}, {152859979,2,1357}, {152859982,3,1398},
{152859983,2,1414}, {152859986,7,1458}, {152859992,7,1566}, {152859993,5,1589}, {152859995,2,1619},
{152859996,4,1639}, {152859998,5,1680}, {152860000,5,1709}, {152860004,4,1757}, {152860009,3,1839},
{152860009,6,1839}, {152860012,5,1869}, {152860015,7,1912}, {152860016,4,1937}, {152860019,2,1991},
{152860022,3,2022}, {152860023,4,2040}, {152860028,3,2048}, {152860028,2,2048}, {152860029,2,2057},
{152860030,2,2044}, {152860030,4,2044}, {152860031,2,2059}, {152860032,5,2057}, {152860033,3,2056},
{152860034,4,2051}, {152860035,3,2046}, {152860036,3,2062}, {152860036,3,2062}, {152860039,2,2088},
{152860039,4,2088}, {152860041,3,2097}, {152860042,4,2102}, {152860044,4,2107}, {152860044,2,2107},
{152860049,6,2078}, {152860054,4,2094}, {152860057,2,2075}, {152860058,2,2083}, {152860060,2,2087},
{152860062,3,2099}, {152860067,5,2068}, {152860067,4,2068}, {152860069,4,2066}, {152860070,6,2068},
{152860073,4,2055}, {152860074,6,2058}, {152860074,4,2058}, {152860076,4,2047}, {152860077,2,2050},
{152860078,3,2066}, {152860078,3,2066}, {152860080,3,2055}, {152860080,3,2055}, {152860081,5,2045},
{152860082,2,2036}, {152860082,3,2036}, {152860084,6,2046}, {152860087,8,2033}, {152860087,4,2033},
{152860088,2,2021}, {152860088,3,2021}, {152860094,3,2003}, {152860094,2,2003}, {152860094,5,2003},
{152860095,6,1995}, {152860096,5,2004}, {152860096,2,2004}, {152860097,2,2007}, {152860098,3,2015},
{152860099,4,2012}, {152860100,2,2023}, {152860101,2,2017}, {152860102,3,2026}, {152860104,2,2040},
{152860106,4,2031}, {152860107,3,2036}, {152860108,2,2036}, {152860111,2,2055}, {152860113,6,2042},
{152860113,4,2042}, {152860114,2,2040}, {152860115,2,2045}, {152860120,3,2066}, {152860120,4,2066},
{152860121,9,2042}, {152860121,4,2042}, {152860125,2,2056}, {152860125,3,2056}, {152860126,4,2043},
{152860127,3,2054}, {152860130,3,2079}, {152860131,3,2092}, {152860133,4,2110}, {152860134,6,2117},
{152860136,2,2125}, {152860137,3,2127}, {152860138,5,2117}, {152860139,8,2109}, {152860139,5,2109},
{152860140,7,2114}, {152860141,2,2125}, {152860141,3,2125}, {152860142,2,2139}, {152860144,8,2155},
{152860144,3,2155}, {152860145,2,2152}, {152860146,2,2158}, {152860146,5,2158}, {152860148,2,2154},
{152860149,3,2157}, {152860150,6,2144}, {152860152,2,2143}, {152860152,2,2143}, {152860153,4,2155},
{152860154,5,2166}, {152860156,3,2171}, {152860157,2,2168}, {152860158,3,2165}, {152860161,4,2154},
{152860161,2,2154}, {152860162,4,2145}, {152860163,3,2136}, {152860163,5,2136}, {152860164,2,2146},
{152860166,5,2147}, {152860166,3,2147}, {152860168,6,2137}, {152860171,4,2159}, {152860172,4,2152},
{152860175,2,2173}, {152860175,3,2173}, {152860178,5,2158}, {152860181,3,2131}, {152860182,4,2114},
{152860187,2,2042}, {152860189,4,2017}, {152860193,4,1961}, {152860197,3,1910}, {152860203,4,1820},
{152860204,3,1801}, {152860206,5,1778}, {152860210,4,1722}, {152860211,2,1710}, {152860218,3,1591},
{152860220,3,1550}, {152860221,3,1544}, {152860222,7,1517}, {152860226,2,1456}, {152860228,3,1422},
{152860232,2,1377}, {152860233,2,1367}, {152860239,3,1298}, {152860241,2,1271}, {152860244,3,1241},
{152860245,3,1225}, {152860250,2,1152}, {152860254,4,1097}, {152860260,3,1004}, {152860261,3,984},
{152860262,2,964}, {152860266,3,924}, {152860267,4,913}, {152860271,3,865}, {152860272,5,849},
{152860273,5,832}, {152860277,5,782}, {152860279,3,764}, {152860280,2,750}, {152860281,3,731},
{152860285,2,682}, {152860291,3,632}, {152860293,4,607}, {152860295,2,585}, {152860296,3,563},
{152860311,2,409} }
      { }

      virtual ~KmeanTest() { }
      virtual void SetUp() {
      }

      virtual void TearDown() {
      }
      vector<Testpoint> rawdata;
};


TEST_F(KmeanTest, run) {
   Kmean<Testpoint> kmcl(3, rawdata);
   kmcl.run();
   kmcl.showCluster(cout);
}

